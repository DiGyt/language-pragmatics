{"remainingRequest":"/home/dirk/WebstormProjects/chat_experiment/language-pragmatics/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/dirk/WebstormProjects/chat_experiment/language-pragmatics/src/components/AltChat.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/dirk/WebstormProjects/chat_experiment/language-pragmatics/src/components/AltChat.vue","mtime":1614864124597},{"path":"/home/dirk/WebstormProjects/chat_experiment/language-pragmatics/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/dirk/WebstormProjects/chat_experiment/language-pragmatics/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBWdWUgZnJvbSAndnVlJzsKY29uc3QgRVZFTlRfQ0hBVF9NRVNTQUdFID0gJ2NoYXRfbWVzc2FnZSc7CmNvbnN0IEVWRU5UX0NIQVRfQUNUSVZFID0gJ2luYWN0aXZlJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnQWx0Q2hhdCcsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG1lc3NhZ2VzOiBbXSwKICAgICAgc3RhdHVzTW9uaXRvcjoge30sCiAgICAgIGFjdGl2ZTogIllvdXIgY2hhdCBwYXJ0bmVyIGhhcyBub3QgeWV0IGVudGVyZWQgdGhlIGNoYXQuIiwKICAgICAgdXBkYXRlOiBudWxsCiAgICB9OwogIH0sCiAgc29ja2V0OiB7CiAgICBbRVZFTlRfQ0hBVF9NRVNTQUdFXShwYXlsb2FkKSB7CiAgICAgIHRoaXMubWVzc2FnZXMucHVzaChwYXlsb2FkKTsKICAgICAgVnVlLm5leHRUaWNrKCgpID0+IHsKICAgICAgICB0aGlzLiRyZWZzLmJveC5zY3JvbGxUb3AgPSB0aGlzLiRyZWZzLmJveC5zY3JvbGxIZWlnaHQ7CiAgICAgIH0pOwogICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6bWVzc2FnZXMnLCB0aGlzLm1lc3NhZ2VzKTsKICAgIH0sCiAgICBbRVZFTlRfQ0hBVF9BQ1RJVkVdKHBheWxvYWQpIHsKICAgICAgdGhpcy5zdGF0dXNNb25pdG9yW3BheWxvYWQucGFydGljaXBhbnRJZF0gPSBwYXlsb2FkOwogICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6c3RhdHVzTW9uaXRvcicsIHRoaXMuc3RhdHVzTW9uaXRvcik7CiAgICB9CiAgfSwKICBFVkVOVF9DSEFUX01FU1NBR0UsCiAgRVZFTlRfQ0hBVF9BQ1RJVkUsCiAgY3JlYXRlZCAoKSB7CiAgICB0aGlzLm1vbml0b3JBY3Rpdml0eSgpCiAgfSwKICBkZWFjdGl2YXRlZCgpIHsKICAgIHRoaXMuJG1hZ3BpZS5hZGRSZXN1bHQoeyBxdWVzdGlvbjogIkNoYXQgbXNncyIsIGFuc3dlcjogdGhpcy5tZXNzYWdlc30pOwogICAgY2xlYXJJbnRlcnZhbCh0aGlzLnVwZGF0ZSk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBzZW5kKCkgewogICAgICBjb25zdCBtZXNzYWdlID0gdGhpcy4kcmVmcy50ZXh0LnZhbHVlOwogICAgICBpZiAoIW1lc3NhZ2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy4kbWFncGllLnNvY2tldC5icm9hZGNhc3QoRVZFTlRfQ0hBVF9NRVNTQUdFLCB7CiAgICAgICAgbWVzc2FnZSwKICAgICAgICBwYXJ0aWNpcGFudElkOiB0aGlzLiRtYWdwaWUuc29ja2V0LnBhcnRpY2lwYW50SWQKICAgICAgfSk7CiAgICAgIHRoaXMuJHJlZnMudGV4dC52YWx1ZSA9ICcnOwogICAgICB0aGlzLiRyZWZzLnRleHQuZm9jdXMoKTsKICAgIH0sCiAgICBtb25pdG9yQWN0aXZpdHkoKXsKICAgICAgdGhpcy51cGRhdGUgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgLy8gc2V0IHlvdXJzZWxmIGFjdGl2ZQogICAgICAgIHRoaXMuJG1hZ3BpZS5zb2NrZXQuYnJvYWRjYXN0KEVWRU5UX0NIQVRfQUNUSVZFLCB7CiAgICAgICAgICBzdGF0dXM6ICJhY3RpdmUiLAogICAgICAgICAgcGFydGljaXBhbnRJZDogdGhpcy4kbWFncGllLnNvY2tldC5wYXJ0aWNpcGFudElkLAogICAgICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCkKICAgICAgICB9KTsKICAgICAgICAvLyBjaGVjayBpZiBwYXJ0bmVyIGlzIGFjdGl2ZQogICAgICAgIGZvciAobGV0IFtwYXJ0aWNpcGFudElELCBzdGF0dXNdIG9mIE9iamVjdC5lbnRyaWVzKHRoaXMuc3RhdHVzTW9uaXRvcikpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuc3RhdHVzTW9uaXRvcikKICAgICAgICAgIGlmIChwYXJ0aWNpcGFudElEICE9IHRoaXMuJG1hZ3BpZS5zb2NrZXQucGFydGljaXBhbnRJZCkgewogICAgICAgICAgICBpZiAoc3RhdHVzLnN0YXR1cyA9PT0gImFjdGl2ZSIpIHsKICAgICAgICAgICAgICBpZiAoKG5ldyBEYXRlKCkgLSBuZXcgRGF0ZShzdGF0dXMubGFzdFVwZGF0ZWQpKSA+IDEwICogMTAwMCkgewogICAgICAgICAgICAgICAgdGhpcy5hY3RpdmUgPSAiWW91ciBjaGF0IHBhcnRuZXIgaGFzIGxlZnQgdGhlIGNoYXQuIFBsZWFzZSBjbGljayBgbGVhdmUgY2hhdGAgdG8gZmluaXNoIHRoZSBleHBlcmltZW50LiI7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlID0gIllvdXIgY2hhdCBwYXJ0bmVyIGlzIGFjdGl2ZSI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmFjdGl2ZSk7CiAgICAgICAgfQogICAgICB9LCAzMDAwKQogICAgfQogIH0KfTsK"},{"version":3,"sources":["AltChat.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AltChat.vue","sourceRoot":"src/components","sourcesContent":["\n<template>\n  <div class=\"AltChat\">\n    <div id=\"chatbox_1\" ref=\"box\" class=\"chat-box\">\n      <p id=\"prg\"\n          v-for=\"(message, i) in messages\"\n          :key=\"i\"\n          :class=\"{\n          message: true,\n          me: message.participantId === $magpie.socket.participantId\n        }\"\n          v-text=\"message.message\"\n      ></p>\n    </div>\n    <div class=\"notice-box\">{{active}}</div>\n    <div class=\"chat-input\">\n      <textarea\n          ref=\"text\"\n          cols=\"50\"\n          placeholder=\"Type your message to the other participant here.\"\n          @keydown.enter=\"send\"\n      ></textarea>\n      <button @click.stop=\"send()\" @v>\n        Send\n      </button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Vue from 'vue';\nconst EVENT_CHAT_MESSAGE = 'chat_message';\nconst EVENT_CHAT_ACTIVE = 'inactive';\n\nexport default {\n  name: 'AltChat',\n  data() {\n    return {\n      messages: [],\n      statusMonitor: {},\n      active: \"Your chat partner has not yet entered the chat.\",\n      update: null\n    };\n  },\n  socket: {\n    [EVENT_CHAT_MESSAGE](payload) {\n      this.messages.push(payload);\n      Vue.nextTick(() => {\n        this.$refs.box.scrollTop = this.$refs.box.scrollHeight;\n      });\n      this.$emit('update:messages', this.messages);\n    },\n    [EVENT_CHAT_ACTIVE](payload) {\n      this.statusMonitor[payload.participantId] = payload;\n      this.$emit('update:statusMonitor', this.statusMonitor);\n    }\n  },\n  EVENT_CHAT_MESSAGE,\n  EVENT_CHAT_ACTIVE,\n  created () {\n    this.monitorActivity()\n  },\n  deactivated() {\n    this.$magpie.addResult({ question: \"Chat msgs\", answer: this.messages});\n    clearInterval(this.update);\n  },\n  methods: {\n    send() {\n      const message = this.$refs.text.value;\n      if (!message) {\n        return;\n      }\n      this.$magpie.socket.broadcast(EVENT_CHAT_MESSAGE, {\n        message,\n        participantId: this.$magpie.socket.participantId\n      });\n      this.$refs.text.value = '';\n      this.$refs.text.focus();\n    },\n    monitorActivity(){\n      this.update = setInterval(() => {\n        // set yourself active\n        this.$magpie.socket.broadcast(EVENT_CHAT_ACTIVE, {\n          status: \"active\",\n          participantId: this.$magpie.socket.participantId,\n          lastUpdated: new Date()\n        });\n        // check if partner is active\n        for (let [participantID, status] of Object.entries(this.statusMonitor)) {\n          console.log(this.statusMonitor)\n          if (participantID != this.$magpie.socket.participantId) {\n            if (status.status === \"active\") {\n              if ((new Date() - new Date(status.lastUpdated)) > 10 * 1000) {\n                this.active = \"Your chat partner has left the chat. Please click `leave chat` to finish the experiment.\";\n              } else {\n                this.active = \"Your chat partner is active\";\n              }\n            }\n          }\n          console.log(this.active);\n        }\n      }, 3000)\n    }\n  }\n};\n</script>\n<style>\n.chat {\n  width: 450px;\n}\n\n.chat-box {\n  overflow: auto;\n  height: 400px;\n}\n\n.message {\n  width: 55%;\n  float: left;\n  text-align: left;\n  background: #5187ba7a;\n  border-radius: 4px;\n  padding: 4px;\n  margin: 5px 0;\n}\n\n.message.me {\n  float: right;\n  background: #70ba517a;\n}\n\n.chat-input {\n  display: flex;\n}\n\n.chat-input textarea {\n  flex-grow: 1;\n  height: 32px;\n}\n\n.chat-input button {\n  margin: 0;\n}\n\n.notice-box:hover { background-color: #ff9c00; }\n.notice-box {\n  background-color: #bd975a;\n  border:1px solid #eda93b;\n  font-weight:bold;\n  text-transform:uppercase;\n  letter-spacing: 1px;\n}\n\n</style>\n"]}]}